# GitHub Pages Setup - Documentation Deployment Guide

This document explains how the documentation website is set up and deployed.

## 🎯 Architecture Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                       GitHub Repository                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  main branch (source files only)                               │
│  ├── docs/                    (Documentation markdown files)    │
│  ├── mkdocs.yml               (Configuration)                   │
│  ├── pyproject.toml           (Dependencies)                    │
│  └── .github/workflows/       (GitHub Actions)                  │
│                                                                 │
│  gh-pages branch (build artifacts only - auto-managed)         │
│  └── index.html, css/, js/   (Generated by GitHub Actions)     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
         │
         │ GitHub Actions Workflow
         │ (on push to main)
         │
         ├─ 1. Build: mkdocs build
         │
         ├─ 2. Upload: artifacts
         │
         └─ 3. Deploy: to gh-pages branch
              └─ GitHub Pages serves from gh-pages
                 URL: https://Shion1305.github.io/otel-tutorial-rust/
```

## 📋 What's in Each Branch

### ✅ `main` Branch (What You Push)
Contains only **source files**:
- `docs/` - Markdown documentation files
- `mkdocs.yml` - MkDocs configuration
- `pyproject.toml` - Python dependencies
- `.github/workflows/` - GitHub Actions workflows
- `README.md` - Project README
- Source code (Rust, config files, etc.)

**NOT included:** Built website files (`site/` directory)

### ⚙️ `gh-pages` Branch (Managed by GitHub Actions)
Contains only **built artifacts**:
- `index.html` - Generated home page
- `css/` - Stylesheets
- `js/` - JavaScript
- `sitemap.xml` - Search engine sitemap
- All other generated files

**Note:** You never push to this branch directly - GitHub Actions handles it automatically.

## 🔄 Deployment Process

### Step 1: Push to Main
```bash
git add docs/ mkdocs.yml
git commit -m "Update documentation"
git push origin main
```

### Step 2: GitHub Actions Triggers Automatically
The workflow defined in `.github/workflows/deploy-docs.yml`:

1. **Checks out code** from main branch
2. **Sets up Python 3.12**
3. **Installs dependencies** from `pyproject.toml`
4. **Builds site** with `mkdocs build`
   - Creates `site/` directory with HTML files
5. **Uploads artifact** for storage (temporary, 7 days)
6. **Deploys to gh-pages** using `actions/deploy-pages`
   - This automatically pushes to `gh-pages` branch
7. **Publishes website** via GitHub Pages

### Step 3: View Live Site
- Initial build: 1-2 minutes
- Subsequent builds: ~30 seconds
- Website updates automatically at:
  ```
  https://Shion1305.github.io/otel-tutorial-rust/
  ```

## 🛠️ Workflow File Explanation

See `.github/workflows/deploy-docs.yml`:

```yaml
name: Deploy Documentation to GitHub Pages

on:
  push:
    branches:
      - main
    paths:
      - 'docs/**'           # Triggers only if docs change
      - 'mkdocs.yml'
      - 'pyproject.toml'

jobs:
  build:
    # 1. Builds the documentation
    # 2. Uploads as temporary artifact
    
  deploy:
    # 1. Downloads artifact
    # 2. Deploys to gh-pages branch
    # 3. GitHub Pages serves it
```

## 📦 Build Artifacts in .gitignore

The `site/` directory (build output) is excluded from git:

```gitignore
# MkDocs build output (deployed to gh-pages branch via GitHub Actions)
/site/

# Python virtual environments
venv/
.venv/
```

**Why?** Keep main branch clean with only source files:
- Smaller repository size
- Cleaner commit history
- Avoids merge conflicts
- Build artifacts auto-generated as needed

## ✅ GitHub Pages Configuration

### Automatic Configuration
GitHub Actions automatically configures GitHub Pages by using `actions/deploy-pages@v2`.

### Manual Verification (Optional)
If needed, verify in your GitHub repository settings:

1. Go to **Settings → Pages**
2. Check:
   - **Source:** GitHub Actions (or Deploy from branch → gh-pages)
   - **Branch:** gh-pages (if using manual deploy)
   - **Folder:** / (root)

The workflow handles this automatically - no manual setup needed!

## 🔍 Troubleshooting

### Site Not Updating?
1. Check **Actions** tab in GitHub
2. Look for failed workflows
3. View logs to see what went wrong

### Common Issues

**"No changes to deploy"**
- The workflow only triggers on changes to:
  - `docs/` directory
  - `mkdocs.yml`
  - `pyproject.toml`
  - The workflow file itself
- Make a change to one of these files to trigger deployment

**"Site not found" (404)**
- Wait 1-2 minutes for initial deployment
- Clear browser cache
- Check if repository is public (private repos need paid GitHub Pages)

**"Build failed"**
- Check GitHub Actions logs
- Common issues:
  - Missing documentation file referenced in `mkdocs.yml`
  - Broken links in markdown
  - Python dependency issues

## 📊 Artifacts & Retention

The workflow stores temporary build artifacts for 7 days:

```yaml
- name: Upload artifact
  uses: actions/upload-artifact@v4
  with:
    name: site
    path: site/
    retention-days: 7
```

These are:
- **Used for:** Deploying to gh-pages
- **Deleted after:** 7 days (automatically)
- **Purpose:** Temporary storage during deployment

## 🚀 Advanced: Custom Domain (Optional)

To use a custom domain like `docs.yourdomain.com`:

1. **Add DNS record:**
   - Type: CNAME
   - Name: docs
   - Value: Shion1305.github.io

2. **Update mkdocs.yml:**
   ```yaml
   site_url: https://docs.yourdomain.com/
   ```

3. **GitHub Pages settings:**
   - Settings → Pages → Custom domain
   - Enter: `docs.yourdomain.com`
   - Check: "Enforce HTTPS"

## 📈 Performance

- **Build time:** < 1 minute (usually ~30 seconds)
- **Deployment time:** < 1 minute total
- **Site size:** ~5-10 MB
- **Search:** Client-side (instant, offline)

## 🔐 Branch Protection (Recommended)

To prevent accidental breaks, protect the main branch:

1. Go to **Settings → Branches**
2. Add rule for `main`:
   - Require pull request reviews
   - Require status checks to pass (GitHub Actions)
   - Dismiss stale reviews

This ensures:
- Documentation builds before merging
- Code review process
- No broken docs deployed

## 📝 Local vs Remote

### Local Development
```bash
# Make changes locally
mkdocs serve
# Visit http://localhost:8000

# Test changes
git add docs/
git commit -m "Update docs"
```

### Push to GitHub
```bash
git push origin main
# GitHub Actions automatically:
# 1. Builds the site
# 2. Deploys to gh-pages
# 3. Updates live website
```

## 🎯 Workflow

1. **Edit documentation** locally
2. **Test locally** with `mkdocs serve`
3. **Commit changes** with gitmoji style
4. **Push to main** branch
5. **GitHub Actions** builds and deploys
6. **Live site** updates automatically

That's it! The workflow handles everything.

## 🧹 Cleanup (if needed)

If you need to start fresh:

```bash
# Delete local build artifacts
rm -rf site/

# Rebuild locally
mkdocs build

# Delete gh-pages branch (GitHub Pages will recreate it)
git push origin --delete gh-pages
```

The next push to main will rebuild and redeploy.

## 📚 Related Files

- `.github/workflows/deploy-docs.yml` - GitHub Actions workflow
- `mkdocs.yml` - MkDocs configuration
- `pyproject.toml` - Python dependencies
- `.gitignore` - Files excluded from git
- `DOCS_SETUP.md` - Local documentation setup
- `MKDOCS_SUMMARY.md` - MkDocs features summary

## ✨ Summary

✅ **Fully automated deployment**
- Push to main → Site updates automatically
- No manual commands needed
- GitHub Actions handles everything

✅ **Clean repository**
- Source files only in main branch
- Build artifacts in separate gh-pages branch
- Site/ excluded from version control

✅ **Zero-maintenance hosting**
- GitHub Pages is free
- Automatic HTTPS
- No server to manage
- Scales automatically

✅ **Professional workflow**
- Build verification before deploy
- Artifacts preserved for 7 days
- Easy rollback if needed
- Full deployment history in Actions tab

---

**You're all set!** Push to main and your documentation automatically deploys. 🚀

